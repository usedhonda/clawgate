# gog-secretary v2 + OpenClaw knowledge persistence

## Summary

Upgraded `gog-secretary` from v1 to v2 with security hardening, and created OpenClaw skill files for knowledge persistence.

## Changes

### `/usr/local/bin/gog-secretary` (rewritten)

1. **Alias normalization**: `mail`/`email` -> `gmail`, `cal` -> `calendar` (prevents allowlist bypass)
2. **Dangerous flag blocking**: `--account`, `--client`, `--force` blocked before any processing
3. **Absolute path**: `GOG_BIN="/usr/local/bin/gog"` (prevents PATH poisoning)
4. **Allowlist expansion**: Added `gmail:get`, `gmail:messages`, `gmail:url` (read-only email access)
5. **Rate limiting**: mkdir-based atomic lock (macOS-compatible, no `flock`)
   - calendar create: 6/h, update: 12/h, tasks add: 30/h, gmail drafts: 10/h
6. **JSONL audit log**: `~/.openclaw/logs/gog-secretary.log` with structured JSON entries
7. **Args reconstruction**: Normalized service name passed to `gog` (not the original alias)

### OpenClaw skill files

- `~/.openclaw/sandboxes/agent-main-0d71ad7a/skills/gog-secretary/SKILL.md` (new)
- `~/.openclaw/sandboxes/agent-main-0d71ad7a/skills/gog/SKILL.md` (secretary wrapper note added)
- `~/.openclaw/workspace/TOOLS.md` (gog/gog-secretary usage section added)

## Test Results

| Test | Expected | Actual |
|------|----------|--------|
| `mail send` (alias bypass) | BLOCKED | BLOCKED |
| `email send` (alias bypass) | BLOCKED | BLOCKED |
| `--account=other@x.com` | BLOCKED | BLOCKED |
| `--client=other` | BLOCKED | BLOCKED |
| `--force` | BLOCKED | BLOCKED |
| `gmail get MSG_ID` | ALLOWED | ALLOWED |
| `gmail messages search` | ALLOWED | ALLOWED |
| `calendar events` | ALLOWED | ALLOWED |
| `tasks lists` | ALLOWED | ALLOWED |
| `cal events` (alias passthrough) | ALLOWED | ALLOWED |
| `email search` (alias passthrough) | ALLOWED | ALLOWED |
| Rate limit (calendar create x7) | 7th RATE_LIMITED | 7th RATE_LIMITED |
| JSONL audit log | All entries logged | 16 entries verified |

## Bug Fix During Implementation

- `flock` does not exist on macOS -> replaced with `mkdir`-based atomic lock
- `wc -l < "$file"` fails when file doesn't exist under `set -e` -> added `touch "$file"` fallback
